function _Binding(e){this.value={},this.arr=e}function SPARQL_DL_Array(e){if(this.arr=[],this.mappings={},e)for(var t=0;t<e.length;t++)e[t]&&(this.mappings[e[t]]=new jOWL.Array)}jOWL=window.jOWL={},jOWL.version="1.0";try{console.log("...")}catch(e){console=window.console={log:function(){}}}!function(e){jOWL.NS=function(e,t){if(!arguments.length)return"xmlns:"+jOWL.NS.owl.prefix+"='"+jOWL.NS.owl()+"' xmlns:"+jOWL.NS.rdf.prefix+"='"+jOWL.NS.rdf()+"' xmlns:"+jOWL.NS.rdfs.prefix+"='"+jOWL.NS.rdfs()+"' xmlns:"+jOWL.NS.xsd.prefix+" ='"+jOWL.NS.xsd()+"'";if(1==arguments.length){for(var r=e.get(0).attributes,n=0;n<r.length;n++){var i=r[n].nodeName.split(":");2==i.length&&(r[n].nodeValue==jOWL.NS.owl.URI?jOWL.NS.owl.prefix=i[1]:r[n].nodeValue==jOWL.NS.rdf.URI?jOWL.NS.rdf.prefix=i[1]:r[n].nodeValue==jOWL.NS.rdfs.URI?jOWL.NS.rdfs.prefix=i[1]:r[n].nodeValue==jOWL.NS.xsd.URI?jOWL.NS.xsd.prefix=i[1]:jOWL.NS(i[1],r[n].nodeValue))}return void(jOWL.namespace=e.attr("xml:base")||e.attr("xmlns"))}jOWL.NS[e]=function(e){return e?"base"==arguments.callee.prefix?e:arguments.callee.prefix+":"+e:arguments.callee.URI},jOWL.NS[e].prefix=e,jOWL.NS[e].URI=t},jOWL.NS("owl","http://www.w3.org/2002/07/owl#"),jOWL.NS("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),jOWL.NS("rdfs","http://www.w3.org/2000/01/rdf-schema#"),jOWL.NS("xsd","http://www.w3.org/2001/XMLSchema#"),e.fn.extend({rdfID:function(e){var t=this.attr(jOWL.NS.rdf("ID"));return!!t&&(t=jOWL.resolveURI(t),e?t.toLowerCase()==jOWL.resolveURI(e.toString()).toLowerCase():t)},RDF_Resource:function(e){function t(e){var t=jOWL.Xpath(jOWL.NS.owl("Class"),e);return console.log("etc",t),1==t.length&&new jOWL.Type.Class(t).URI}if(!this.length)return!1;var r=this.attr(jOWL.NS.rdf("resource"));if(!r){var n=this.get(0);switch(n.nodeName){case jOWL.NS.rdfs("subClassOf"):r=t(n);break;case jOWL.NS.owl("disjointWith"):r=t(n);break;case jOWL.NS.owl("allValuesFrom"):r=t(n);break;case jOWL.NS.owl("someValuesFrom"):r=t(n);break;case jOWL.NS.owl("onProperty"):var i=jOWL.Xpath(jOWL.NS.owl("ObjectProperty"),n);0===i.length&&(i=jOWL.Xpath(jOWL.NS.owl("DatatypeProperty"),n)),0===i.length&&(i=jOWL.Xpath(jOWL.NS.owl("FunctionalProperty"),n)),r=i.attr(jOWL.NS.rdf("about"));break;default:return!1}}return!!r&&(r=jOWL.resolveURI(r),e?r.toLowerCase()==jOWL.resolveURI(e.toString()).toLowerCase():r)},rdfAbout:function(e){var t=this.attr(jOWL.NS.rdf("about"));return!!t&&(t=jOWL.resolveURI(t),e?t.toLowerCase()==jOWL.resolveURI(e.toString()).toLowerCase():t)}}),document.implementation.hasFeature("XPath","3.0")&&(XMLDocument.prototype.selectNodes=function(e,t){t||(t=this);for(var r=this.createNSResolver(this.documentElement),n=this.evaluate(e,t,r,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),i=[],s=0;s<n.snapshotLength;s++)i[s]=n.snapshotItem(s);return i},Element.prototype.selectNodes=function(e){if(this.ownerDocument.selectNodes)return this.ownerDocument.selectNodes(e,this);throw"For XML Elements Only"},XMLDocument.prototype.selectSingleNode=function(e,t){t||(t=this);var r=this.selectNodes(e,t);return r.length>0?r[0]:null},Element.prototype.selectSingleNode=function(e){if(this.ownerDocument.selectSingleNode)return this.ownerDocument.selectSingleNode(e,this);throw"For XML Elements Only"}),jOWL.Xpath=function(t,r){var n=null;r&&(n=r.each?r.get(0):r);var i=n?n.selectNodes(t):jOWL.document.selectNodes(t);return e(i)},jOWL.priv={Array:{isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},pushUnique:function(e,t){return jOWL.priv.Array.getIndex(e,t)===-1&&(e.push(t),!0)},getIndex:function(e,t){for(var r=0;r<e.length;r++)if(t==e[r])return r;return-1},unique:function(e){for(var t=[],r="",n=0;n<e.length;n++){var i=e[n];i!=r&&(t[t.length]=i),r=i}return t}}},jOWL.Type={},jOWL.Array=function(t,r){var n=this;this.items=[],t&&(r?e.each(t,function(){var t=this instanceof jOWL.Type.Thing?this:jOWL(e(this));n.items.push(t)}):this.items=t),this.length=this.items.length},jOWL.Array.prototype={jOWL:jOWL.version,isArray:!0,bind:function(t,r){return this.map(function(){var n=t?t.clone(!0):e("<span/>"),i=this.bind(n).append(document.createTextNode(" "));return r&&r.call(i,i,this),i.get(0)})},concat:function(e,t){var r=this;return e.each?e.each(function(){t?r.push(this):r.pushUnique(this)}):(r.items=r.items.concat(e.items),this.length=r.items.length),this},contains:function(e){return!!this.get(e)},each:function(e,t){var r,n=this,i=!1;if(t)for(r=this.items.length-1;r>=0&&!i;r--)!function(){var t=n.eq(r);e.call(t,t,r)===!1&&(i=!0)}();else for(r=0;r<this.items.length&&!i;r++)!function(){var t=n.eq(r);e.call(t,t,r)===!1&&(i=!0)}();return this},eq:function(e){return e<0||e>this.items.length-1?null:this.items[e]},filter:function(e){var t=this;return this.each(function(r,n){var i=e.call(r,r,n);i||t.items.splice(n,1)},!0),this.length=this.items.length,this},getIndex:function(e){var t=-1;if(e.equals)this.each(function(r,n){if(this.equals&&this.equals(e))return t=n,!1});else{if("number"==typeof e)return e;var r="string"==typeof e?e:e.name,n=e.URI||r;this.each(function(e,i){this.URI?this.URI==n&&(t=i):this.name==r&&(t=i)})}return t},get:function(e){return this.eq(this.getIndex(e))},map:function(e){var t=[];return this.each(function(){t.push(e.call(this,this))}),t},push:function(e){return this.items.push(e),this.length=this.items.length,this},pushUnique:function(e){return this.get(e)||this.push(e).get(e)},toString:function(){return this.map(function(){return this.URI}).join(", ")},associative:function(){var e={};return this.each(function(){this.URI&&(e[this.URI]=this)}),e}},jOWL.options={reason:!0,locale:!1,defaultlocale:"en",dictionary:{create:!0,addID:!0},onParseError:function(e){alert("jOWL parseError: "+e)},cacheProperties:!0,niceClassLabels:!0},jOWL.document=null,jOWL.namespace=null,jOWL.load=function(t,r,n){var i=this;e.get(t,function(e){r(i.parse(e,n))})},jOWL.parse=function(t,r){if("string"==typeof t&&(t=jOWL.fromString(t)),jOWL.document=t,"parsererror"==t.documentElement.nodeName)return jOWL.options.onParseError(t.documentElement.firstChild.nodeValue),!1;var n=new jOWL.Document(t,e.extend(jOWL.options,r)),i=e(t.documentElement);jOWL.NS(i),n.resetIndices(),n.getIDIndex();var s=n.createXmlElement(jOWL.NS.owl,"Class").attr(jOWL.NS.rdf,"about",jOWL.NS.owl()+"Thing");return jOWL.Thing=new jOWL.Type.Thing(s),jOWL.Thing.type=!1,n},jOWL.toString=function(e){return e?(new XMLSerializer).serializeToString(e):jOWL.toString(jOWL.document)},jOWL.fromString=function(e){var t;if(document.implementation.createDocument)t=(new DOMParser).parseFromString(e,"text/xml");else if(window.ActiveXObject){var r=new ActiveXObject("Microsoft.XMLDOM");r.async="false",r.validateOnParse=!1,r.loadXML(e),t=r}return t},jOWL.isExternal=function(e){var t=jOWL.resolveURI(e,!0);return t[0]!=jOWL.namespace&&t},jOWL.resolveURI=function(t,r){if("string"!=typeof t){if(t instanceof e)throw new Error("No jquery object allowed");var n=t instanceof jOWL.Element?t.node:t;return t=n.localName||n.baseName,n.namespaceURI&&(t=n.namespaceURI+t),jOWL.resolveURI(t,r)}var i=t,s=jOWL.namespace;if(0===t.indexOf("http")){var a=t.indexOf("#");a<=0&&(a=t.lastIndexOf("/")),a>0&&(s=t.substring(0,a+1),i=t.substring(a+1))}else if("#"==t.charAt(0))return t.substring(1);return r?[s,i]:s==jOWL.namespace?i:t},jOWL.type=function(e){switch(e.nodeName){case jOWL.NS.owl("Class"):return jOWL.Type.Class;case jOWL.NS.rdfs("Class"):return jOWL.Type.Class;case jOWL.NS.owl("Ontology"):return jOWL.Type.Ontology;case jOWL.NS.owl("ObjectProperty"):return jOWL.Type.ObjectProperty;case jOWL.NS.owl("DatatypeProperty"):return jOWL.Type.DatatypeProperty;case jOWL.NS.owl("FunctionalProperty"):return jOWL.Type.Property;case jOWL.NS.rdf("Property"):return jOWL.Type.Property;case jOWL.NS.owl("InverseFunctionalProperty"):return jOWL.Type.ObjectProperty;case jOWL.NS.owl("TransitiveProperty"):return jOWL.Type.ObjectProperty;case jOWL.NS.owl("SymmetricProperty"):return jOWL.Type.ObjectProperty;case jOWL.NS.owl("AnnotationProperty"):return jOWL.Type.DatatypeProperty;default:switch(e.namespaceURI){case jOWL.NS.owl():return e.nodeName==jOWL.NS.owl("Thing")&&jOWL.Type.Individual;case jOWL.NS.rdf():return!1;case jOWL.NS.rdfs():return!1;default:return jOWL.Type.Individual}}},jOWL.getXML=function(t){function r(e){var t=jOWL.index("ID")[e];return t?t:null}var n=[];if("string"==typeof t){var i=r(t);i&&n.push(i)}else jOWL.priv.Array.isArray(t)&&e.each(t,function(){var e=r(this);e&&n.push(e)});return n},jOWL.create=function(e,t,r){var n=r?r:jOWL.document,i={attr:function(e,t,r){return this.node.setAttributeNS(e(),e(t),r),this},appendTo:function(e){var t=e.node?e.node:e;return t.appendChild(this.node),this},text:function(e,t){var r=t?n.createCDATASection(e):n.createTextNode(e);return this.node.appendChild(r),this}};return i.node=n.createElementNS(e(),e(t)),i},jOWL.create.document=function(e){var t=[],r=e||window.location.href+"#";return t.push('<?xml version="1.0"?>'),t.push("<"+jOWL.NS.rdf("RDF")+' xml:base="'+r+'" xmlns="'+r+'" '+jOWL.NS()+">"),t.push("   <"+jOWL.NS.owl("Ontology")+" "+jOWL.NS.rdf("about")+'=""/>'),t.push("</"+jOWL.NS.rdf("RDF")+">"),jOWL.fromString(t.join("\n"))},jOWL.throttle=function(t,r){r=e.extend({modify:function(e){},onComplete:function(e){},async:!0,chewsize:5,startIndex:0,timing:5},r);var n=t.jOWL?t.items:t instanceof e?e.makeArray(t):t,i=r.startIndex?n.slice(startIndex):n.concat(),s=[];!function(){for(var e=r.chewsize,t=[];e>0&&i.length>0;){var n=i.shift();e--;var a=r.modify.call(n,n);a&&(s.push(a),t.push(a))}r.onUpdate&&r.onUpdate(t),i.length>0?r.async?setTimeout(arguments.callee,r.timing):arguments.callee():r.onComplete(s)}()},jOWL.getURLParameters=function(){var e=window.location.href.split("?",2),t={};if(1==e.length)return{};for(var r=e[1].split("&"),n=0;n<r.length;n++){var i=r[n].split("=");2==i.length&&(t[i[0]]=i[1])}return t},jOWL.permalink=function(e){if(e){if(!e.URI)return!1;var t=window.location.href.split("?",2);if(window.location.search&&(t=t[0]),e instanceof jOWL.Type.Class)return t+"?owlClass="+escape(e.URI)}else{var r=jOWL.getURLParameters();if(r.owlClass)return jOWL(unescape(r.owlClass))}return!1},jOWL.Manchester=function(e){var t=[];if(e.isClass){var r=e.oneOf().map(function(){return this.label()});r.length&&t.push("{ "+r.join(", ")+" }")}return t.join(", ")}}(jQuery),String.prototype.searchMatch=function(e,t){if(this.search(new RegExp(e,"i"))>-1)return 1;for(var r=0,n=e.match(new RegExp("\\w+","ig")),i=0;i<n.length;i++)this.search(n[i])>-1&&r++;return r==n.length?0:-1},String.prototype.beautify=function(){var e=new RegExp("([a-z0-9])([A-Z])","g"),t=new RegExp("([A-Z])([A-Z0-9])([a-z])","g"),r=new RegExp("_","g");return this.replace(e,"$1 $2").replace(t,"$1 $2$3").replace(r," ")},jOWL.Type.Thing=Class.extend({initialize:function(e){if($(e.node).data("binding"))throw"already exists";this.parseNew(e)},equals:function(e){var t="string"==typeof e?jOWL.resolveURI(e):e.URI;return t===this.URI},parseNew:function(e){if(!(e instanceof jOWL.Element))throw new Error("no Element");var t=e.rdfID()||e.rdfAbout();t?(t=jOWL.resolveURI(t),this.isExternal=jOWL.isExternal(t)):(t="anonymousOntologyObject",this.isAnonymous=!0),this.isExternal?(this.baseURI=this.isExternal[0],this.name=this.isExternal[1],this.URI=this.baseURI+this.name):(this.baseURI=jOWL.namespace,this.name=t,this.URI=this.name),this.element=e,$(this.element.node).data("binding",this),this.type=e.nodeName()},annotations:function(e){return this.element?this.element.selectNodes(e):[]},description:function(e){var t=this.annotations(jOWL.NS.rdfs("comment"));return t.map(function(e){return e.text()})},terms:function(){var e=[],t=this,r=this.element.document.options;return r.dictionary.addID&&"anonymousOntologyObject"!=this.name&&e.push([this.name.beautify(),this.URI,r.defaultlocale,this.type]),this.annotations(jOWL.NS.rdfs("label")).forEach(function(n){for(var i=n.attr("xml:lang")||r.defaultlocale,s=n.text(),a=!1,o=0;o<e.length;o++)e[o][0].toUpperCase()==s.toUpperCase()&&e[o][2]==i&&(a=!0);a||e.push([s,t.URI,i,t.type])}),e},label:function(e){var t=!1,r=this.element.document.options,n=e||r.locale;return this.annotations(jOWL.NS.rdfs("label")).forEach(function(e){if(!n)return t=e.text(),!1;var i=e.attr("xml:lang")||r.defaultlocale;return i==n?(t=e.text(),!1):void 0}),t?t:"anonymousOntologyObject"==this.name?jOWL.Manchester(this)||"anonymous Object":r.niceClassLabels&&(this instanceof jOWL.Type.Class||this instanceof jOWL.Type.Individual)?this.name.beautify():this.name},bind:function(e){return e.text(this.label()).attr("typeof",this.type).attr("title",this.URI)}}),jOWL.Type.External=Class.extend(jOWL.Type.Thing,{initialize:function(e){this.isExternal=!0,this.name=e,this.type="Thing",this.URI=e;var t=jOWL.isExternal(e);t&&(this.baseURI=t[0],this.name=t[1])},label:function(){return this.name},terms:function(){return[]}}),jOWL.Element=Class.extend({initialize:function(e,t){if(!(e instanceof jOWL.Document))throw new Error("no document");this.node=t,this.document=e,this._data={}},hasNamespace:function(e){return this.node.namespaceURI==e},text:function(){return $(this.node).text()},attr:function(e,t,r){return void 0===t?$(this.node).attr(e):void 0===r?$(this.node).attr(e(t)):(this.node.setAttributeNS(e(),e(t),r),this)},parent:function(){var e=this.node.parentNode;return e&&11!=e.nodeType?new jOWL.Element(this.document,e):null},_siblings:function(e,t){for(var r=[];e&&e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(new jOWL.Element(this.document,e));return r},siblings:function(){var e=this.parent();return e?this._siblings(e.node.firstChild,this.node):[]},children:function(){return this._siblings(this.node.firstChild,void 0)},rdfID:function(e){var t=this.attr(jOWL.NS.rdf,"ID");if(!t)return null;var r=jOWL.resolveURI(t);return e?r.toLowerCase()==jOWL.resolveURI(e.toString()).toLowerCase():r},rdfAbout:function(e){var t=this.attr(jOWL.NS.rdf,"about");if(!t)return null;var r=jOWL.resolveURI(t);return e?r.toLowerCase()==jOWL.resolveURI(e.toString()).toLowerCase():r},rdfResource:function(e){function t(e){var t=e.selectNodes(jOWL.NS.owl("Class"));return 1==t.length&&new jOWL.Type.Class(t[0]).URI}var r=this.attr(jOWL.NS.rdf,"resource");if(r||(r=this.rdfAbout()),r||(r=this.rdfID()),!r)switch(this.nodeName()){case jOWL.NS.rdfs("subClassOf"):r=t(this);break;case jOWL.NS.owl("disjointWith"):r=t(this);break;case jOWL.NS.owl("allValuesFrom"):r=t(this);break;case jOWL.NS.owl("someValuesFrom"):r=t(this);break;case jOWL.NS.owl("onProperty"):var n=this.selectNodes(jOWL.NS.owl("ObjectProperty"));0===n.length&&(n=this.selectNodes(jOWL.NS.owl("DatatypeProperty"))),0===n.length&&(n=this.selectNodes(jOWL.NS.owl("FunctionalProperty"))),n.length&&(r=n[0].attr(jOWL.NS.rdf,"about"));break;default:return!1}return!!r&&(r=jOWL.resolveURI(r),e?r.toLowerCase()==jOWL.resolveURI(e.toString()).toLowerCase():r)},nodeName:function(){return this.node.nodeName},hasNodeName:function(e,t){return t?e(t)==this.nodeName():e==this.nodeName()},selectSingleNode:function(e){if(this.node.ownerDocument.selectSingleNode){var t=this.node.ownerDocument.selectSingleNode(e,this.node);if(t)return new jOWL.Element(this.document,t)}return null},selectNodes:function(e){var t=this;if(this.node.ownerDocument.selectNodes){var r=this.node.ownerDocument.selectNodes(e,this.node);if(r&&r.length)return r.map(function(e){return new jOWL.Element(t.document,e)})}return[]},data:function(e,t){return void 0===t?this._data[e]:(this._data[e]=t,this)}}),jOWL.Load=Class.extend({initialize:function(e){this.uri=e,this.result=null},then:function(e){return this._success=e,this.result&&this._success(this.result),this},resolve:function(e){this.result=e,this._success&&this._success(e)}}),jOWL.Document=Class.extend({initialize:function(e,t){this.document=e,this.indices={},this.lazyload={},this.options=$.extend({},t)},createXmlElement:function(e,t){return new jOWL.Element(this,this.document.createElementNS(e(),e(t)))},selectNodes:function(e){var t=this.document.selectNodes(e,this.document);if(!t||!t.length)return[];var r=this;return t.map(function(e){return new jOWL.Element(r,e)})},subscribe:function(e){var t=new jOWL.Load;if(this.indices.IDs){var r=this.indices.IDs[e];if(r)return t.resolve(r),t}return this.lazyload[e]||(this.lazyload[e]=[]),this.lazyload[e].push(t),t},_indexIntersection:function(e){if(e&&e.URI){var t=this.indices.II.get(e);t?console.log("duplicate intersection found between : (Ignoring) "+e.URI+"  and "+t.URI):(this.indices.I[e.URI]||(this.indices.I[e.URI]=new jOWL.Array),this.indices.II.push(e),this.indices.I[e.URI].push(e))}},_indexProperty:function(e){this.indices.P.push(e)},_indexElement:function(e){if(e){var t=e.URI;this.indices.IDs[t]=e,this.lazyload[t]&&(this.lazyload[t].forEach(function(t){t.resolve(e)}),delete this.lazyload[t]),this.indices.caseIDs[t.replace(/ /g,"").toLowerCase()]=e,e instanceof jOWL.Type.Individual?(this.indices.T[e.Class]||(this.indices.T[e.Class]=new jOWL.Array),this.indices.T[e.Class].push(e)):e instanceof jOWL.Type.Property&&this._indexProperty(e),this.indices.D=this.indices.D.concat(e.terms())}},getIDIndex:function(){if(this.indices.IDs)return this.indices.IDs;var e=new Date;this.indices.IDs={},this.indices.caseIDs={},this.indices.T={},this.indices.P=new jOWL.Array,this.indices.D=[],this.indices.II=new jOWL.Array,this.indices.I={};var t=this.indices,r=this;return this.selectNodes("//*[@"+jOWL.NS.rdf("ID")+"]").forEach(function(e){var t=r.getResource(e);r._indexElement.call(r,t)}),this.selectNodes("/"+jOWL.NS.rdf("RDF")+"/*[@"+jOWL.NS.rdf("about")+"]").forEach(function(e){var n=r.getResource(e);if(n){var i=n.URI;if(n instanceof jOWL.Type.Class||n instanceof jOWL.Type.Property||n instanceof jOWL.Type.Individual){if(t.IDs[i]){var s=t.IDs[n.URI],a=($(n.element.node).children(),n.element.children());return void(a.length&&s.append(n.element))}r._indexElement.call(r,n)}else n instanceof jOWL.Type.Ontology&&(r.indices.ontology=n)}}),console.log("Loaded in "+((new Date).getTime()-e.getTime())+"ms"),this.indices.IDs},index:function(e,t){switch(e){case"ID":return this.getIDIndex();case"Thing":return this.indices.T;case"dictionary":return this.indices.D;case"property":return this.indices.P;case"intersection":return this.indices.I}},resetIndices:function(){this.indices={}},getOntology:function(){return this.indices.ontology},getResource:function(e,t){if(!e)throw"No resource specified";var r=$.extend({},t);if("string"==typeof e){if(e=jOWL.resolveURI(e),"Thing"==e||e==jOWL.NS.owl()+"Thing")return jOWL.Thing;if("property"==r.type&&jOWL.options.cacheProperties){var n=jOWL.index("property").get(e);if(n)return n;if(jOWL.isExternal(e))return console.log("external resource: "+e),new jOWL.Type.Property(e)}var i=this.indices.IDs[e];return i||(i=this.indices.caseIDs[e]),i?i:jOWL.isExternal(e)?(console.log("external resource: "+e),new jOWL.Type.External(e)):(console.log(e+" not found"),null)}var s=e;e instanceof jOWL.Element&&(s=e.node);var a=$(s).data("binding");if(a)return a;var o=new jOWL.Element(this,s),u=jOWL.type(s);return u?new u(o):null},query:function(e,t){function r(e){var r=!1,i=0;if(t.filter)if("string"==typeof t.filter)r=t.filter==e[3];else for(i=0;i<t.filter.length;i++)t.filter[i]==e[3]&&(r=!0);else if(t.exclude)if(r=!0,"string"==typeof t.exclude)r=t.exclude!==e[3];else for(i=0;i<t.exclude.length;i++)t.exclude[i]==e[3]&&(r=!1);else r=!0;r&&(n[e[1]]||(n[e[1]]=[]),n[e[1]].push({term:e[0],locale:e[2],type:e[3]}))}t=$.extend({exclude:!1},t),"Class"==t.filter&&(t.filter=jOWL.NS.owl("Class"));for(var n=(new jOWL.Array,{}),i=this.index("dictionary"),s=0;s<i.length;s++){var a=i[s],o=(t.exclude,a[0].searchMatch(e));o>-1&&(t.locale?t.locale==a[2]&&r(a):r(a))}return n}}),jOWL.Literal=function(e){this.name=e},jOWL.priv.testObjectTarget=function(e,t){var r=0;if(e.isArray){for(r=0;r<e.length;r++)if(jOWL.priv.testObjectTarget(e.get(r),t))return!0;return!1}if(e.isClass){var n=e.individuals();for(r=0;r<n.length;r++)if(n.get(r).URI==t)return!0}else if(e.URI==t)return!0;return!1},jOWL.priv.Dt=function(e){this.settings=$.extend({base:null,pattern:null,assert:function(e){return!0},match:function(e,t){return!0}},e),this.base=jOWL.Type.Datatype[this.settings.base]},jOWL.priv.Dt.prototype={sanitize:function(e){return this.settings.sanitize?this.settings.sanitize(e):this.base&&this.base.sanitize?this.base.sanitize(e):void 0},assert:function(e){var t=this.sanitize(e);return void 0!==t&&(e=t),!(this.base&&!this.base.assert(e))&&(!(this.settings.pattern&&!this.settings.pattern.test(e))&&this.settings.assert(e))},match:function(e,t){var r=this.sanitize(t);return void 0!==r&&(t=r),!!this.assert(t)&&(!(this.base&&!this.base.match(e,t))&&this.settings.match(e,t))}},jOWL.Type.Datatype=function(e,t){jOWL.Type.Datatype[e]=new jOWL.priv.Dt(t)},jOWL.Type.Datatype(jOWL.NS.xsd()+"integer",{sanitize:function(e){return parseInt(e,10)},assert:function(e){return Math.round(e)==e},match:function(a,b){var check=parseInt(a,10);if(!isNaN(check))return check==b;for(var arr=a.split("&&"),i=0;i<arr.length;i++)arr[i]=b+arr[i];try{return eval(arr.join(" && "))}catch(e){return!1}}}),jOWL.Type.Datatype(jOWL.NS.xsd()+"positiveInteger",{base:jOWL.NS.xsd()+"integer",assert:function(e){return e>0}}),jOWL.Type.Datatype(jOWL.NS.xsd()+"decimal",{base:jOWL.NS.xsd()+"integer"}),jOWL.Type.Datatype(jOWL.NS.xsd()+"float",{base:jOWL.NS.xsd()+"integer"}),jOWL.Type.Datatype(jOWL.NS.xsd()+"double",{base:jOWL.NS.xsd()+"integer"}),jOWL.Type.Datatype(jOWL.NS.xsd()+"negativeInteger",{base:jOWL.NS.xsd()+"integer",assert:function(e){return e<0}}),jOWL.Type.Datatype(jOWL.NS.xsd()+"nonNegativeInteger",{base:jOWL.NS.xsd()+"integer",assert:function(e){return e>=0}}),jOWL.Type.Datatype(jOWL.NS.xsd()+"nonPositiveInteger",{base:jOWL.NS.xsd()+"integer",assert:function(e){return e<=0}}),jOWL.Type.Datatype(jOWL.NS.xsd()+"string");var URIPattern=/^([a-z0-9+.\-]+):(?:\/\/(?:((?:[a-z0-9-._~!$&'()*+,;=:]|%[0-9A-F]{2})*)@)?((?:[a-z0-9-._~!$&'()*+,;=]|%[0-9A-F]{2})*)(?::(\d*))?(\/(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?|(\/?(?:[a-z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})+(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?)(?:\?((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))?(?:#((?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*))?$/i;jOWL.Type.Datatype(jOWL.NS.xsd()+"anyURI",{base:jOWL.NS.xsd()+"string",pattern:URIPattern}),jOWL.Type.Datatype(jOWL.NS.xsd()+"boolean",{sanitize:function(e){return"boolean"==typeof e?e:"true"==e||"false"!=e&&void 0},assert:function(e){return"boolean"==typeof e},match:function(e,t){return"false"===e&&(e=!1),"true"===e&&(e=!0),e===t}}),jOWL.Type.Ontology=Class.extend(jOWL.Type.Thing,{initialize:function(e){this.parent(e)}}),jOWL.Type.Individual=Class.extend(jOWL.Type.Thing,{initialize:function(e){if(this.parent(e),this.type==jOWL.NS.owl("Thing")){var t=this.element.selectNodes(jOWL.NS.rdf("type"));if(!t.length)throw"unable to find a Class for the Individual "+this.name;this.Class=t[0].rdfResource()}else this.Class=jOWL.resolveURI(this.element.node);this.type=jOWL.NS.owl("Thing")},owlClass:function(e){return this._owlClass||(this._owlClass=this.element.document.getResource(this.Class)),this._owlClass},sourceof:function(e,t,r){r=$.extend({inherited:!0,transitive:!0,ignoreGenerics:!1,ignoreClasses:!0,valuesOnly:!0},r);var n=new jOWL.Array;if(this.element.children().filter(function(e){return!e.hasNamespace(jOWL.NS.rdfs.URI)&&(!e.hasNamespace(jOWL.NS.owl.URI)&&!e.hasNamespace(jOWL.NS.rdf.URI))}).forEach(function(i){var s=new jOWL.Type.Restriction(i),a=!e,o=!t;if(a||(a=e.isArray?e.contains(s.property):e.URI==s.property.URI)){if(t)if(s.property instanceof jOWL.Type.ObjectProperty){if(o=jOWL.priv.testObjectTarget(t,s.target),!o&&r.transitive&&s.property.isTransitive){var u=s.getTarget().sourceof(s.property,t,r);u.length>0&&(o=!0)}}else o=s.property.isDatatypeProperty?s.property.assert(s.target,t):t==s.target;else if(r.transitive&&s.property.isTransitive&&!r.ignoreGenerics){var c=s.getTarget(),l=c.sourceof(s.property,null,r);n.concat(l)}a&&o&&n.pushUnique(s)}}),r.inherited){this.owlClass().sourceof(e,t,r).each(function(){var e=this;if(!r.valuesOnly||null!==e.target){var t=this.getTarget();if(!(t instanceof jOWL.Type.Class&&r.ignoreClasses)){for(var i=!1,s=0;s<n.length;s++){var a=n.get(s);a.property.URI==e.property.URI&&(i=!0,r.ignoreGenerics||e.target!=a.target&&n.pushUnique(e))}i||n.pushUnique(e)}}})}return n},localRestrictions:function(e,t){return this.sourceof(e,t,{inherited:!1,transitive:!1})},valueRestrictions:function(e){return this.sourceof(null,null,{ignoreGenerics:!e,valuesOnly:!0})}}),jOWL.Type.Property=Class.extend(jOWL.Type.Thing,{initialize:function(e){if($(e.node).data("binding"))throw new Error("already exists");this.isProperty=!0;var t=this.parseProperty(e);if(t)return t},parseProperty:function(e){this.parseNew(e);var t=e.selectSingleNode(jOWL.NS.rdfs("domain"));t&&(this.domain=t.rdfResource());var r=e.selectSingleNode(jOWL.NS.rdfs("range"));r&&(this.range=r.rdfResource())}}),jOWL.Type.DatatypeProperty=Class.extend(jOWL.Type.Property,{initialize:function(e){if($(e.node).data("binding"))throw new Error("already exists");var t=this.parseProperty(e);return t?t:(this.isDatatypeProperty=!0,void(this.type==jOWL.NS.owl("AnnotationProperty")&&(this.range=jOWL.NS.xsd()+"string")))},assert:function(e,t){var r=jOWL.Type.Datatype[this.range];return r?void 0===t?r.assert(e):r.match(t,e):(console.log(this.range+" datatype reasoning not implemented"),!0)}}),jOWL.Type.ObjectProperty=Class.extend(jOWL.Type.Property,{initialize:function(e){if($(e.node).data("binding"))throw new Error("already exists");var t=this.parseProperty(e);if(t)return t;this.isObjectProperty=!0;var r=this;this.element.selectNodes(jOWL.NS.rdf("type")).forEach(function(e){e.rdfResource()==jOWL.NS.owl()+"TransitiveProperty"&&(r.isTransitive=!0)}),this.element.hasNodeName(jOWL.NS.owl,"TransitiveProperty")&&(r.isTransitive=!0)}}),jOWL.Type.Class=Class.extend(jOWL.Type.Thing,{initialize:function(e){if($(e.node).data("binding"))throw new Error("already exists");this.parseNew(e),this._parentRefs=[],this.intersections=[],this.restrictions=[],this.append(e,!0)},append:function(e,t){var r=this;t||$(this.element.node).append($(e.node).children()),e.children().forEach(function(e){if(e.hasNodeName(jOWL.NS.rdfs("subClassOf"))){var t=e.rdfResource();t?r._parentRefs.push(t):e.children().forEach(function(e){if(e.hasNodeName(jOWL.NS.owl("Restriction"))){var t=new jOWL.Type.Restriction(e,r);r.restrictions.push(t)}})}else if(e.hasNodeName(jOWL.NS.owl("intersectionOf"))){var n=new jOWL.Type.Intersection(e,r);r.intersections.push(n);for(var i=0;i<n.classes.length;i++)r._parentRefs.push(n.classes[i])}})},individuals:function(){var e=new jOWL.Array;new jOWL.SPARQL_DL(this.element.document,"Type(?x, "+this.name+")").execute({async:!1,onComplete:function(t){e=t.jOWLArray("?x")}});return e},oneOf:function(){var e=new jOWL.Array;return this.element.selectNodes(jOWL.NS.owl("oneOf/child::node()")).forEach(function(t){e.push(t.rdfAbout())}),e},children:function(){var e=this.element.data("children");if(e)return e;if(e=new jOWL.Array,this.oneOf().length)return e;var t=this.URI,r=this.element.document.getIDIndex(),n=this;Object.keys(r).forEach(function(i){if(i!==t){var s=r[i];if(s instanceof jOWL.Type.Class){s._parentRefs.forEach(function(t){n.equals(t)&&e.push(s)});var a=s.element.document.index("intersection")[t];if(a){var o=[].concat(s.restrictions);s.intersections.forEach(function(e){o=o.concat(e.restrictions)}),a.each(function(){this.match(i,s._parentRefs,o)&&e.push(s)})}}}});var i=this.element.document.index("property");return i.each(function(){if(this.domain==n.name){var t="//"+jOWL.NS.owl("onProperty")+"[@"+jOWL.NS.rdf("resource")+'="#'+this.name+'"]/parent::'+jOWL.NS.owl("Restriction")+"/..";this.element.document.selectNodes(t).forEach(function(t){if(t.nodeName()==jOWL.NS.owl("intersectionOf")||t.nodeName()==jOWL.NS.rdfs("subClassOf")){var r=t.selectSingleNode("parent::"+jOWL.NS.owl("Class")),i=t.document.getResource(r);i&&!e.contains(i)&&i.name!=n.name&&void 0!==i.name&&e.push(i)}})}}),e.filter(function(){return this.hierarchy(!1),this.parents().contains(t)}),this.element.data("children",e),e},setParents:function(e){return this.element.data("parents",e),e},parents:function(){var e=this,t=this.element.data("parents");if(t)return t;for(var r=[],n=this._parentRefs,i=0;i<n.length;i++)jOWL.priv.Array.pushUnique(r,n[i]);var s=[].concat(this.restrictions);this.intersections.forEach(function(e){s=s.concat(e.restrictions)}),s.forEach(function(t){t.property.domain&&t.property.domain!=e.name&&r.indexOf(t.property.domain)<0&&r.push(t.property.domain)});var a=function(){this.match(e.URI,n,s)&&r.indexOf(this.URI)<0&&r.push(this.URI)};if(jOWL.options.reason)for(var o in this.element.document.index("intersection"))this.element.document.index("intersection")[o].each(a);return r=r.filter(function(e){return"Thing"!=e&&e!=jOWL.Thing.URI}),t=new jOWL.Array,r.length?r.forEach(function(r){var n=e.element.document.getResource(r);if(!n||!(n instanceof jOWL.Type.Class||n instanceof jOWL.Type.External))throw new Error("oopsie "+r);t.push(n)}):t.push(jOWL.Thing),this.setParents(t),t},ancestors:function(){return this.hierarchy(!1).flatindex},hierarchy:function(e){function t(e,r){var n=!0;return r||(r={},n=!1),e.each&&e.each(function(){r[this.URI]||this.URI!=jOWL.NS.owl()+"Thing"&&(n&&(r[this.URI]=!0),this.parents&&t(this.parents(),r))}),r}function r(i){if(i instanceof jOWL.Type.External||i==jOWL.Thing)return void n.pushUnique(i);var s=i.parents();if(1==s.length&&s.contains(jOWL.NS.owl()+"Thing"))return void n.pushUnique(i);var a=jOWL.options.reason?t(s):{};s.filter(function(){return!a[this.URI]}),s.each(function(){var t=n.flatindex.pushUnique(this);e&&(t.invParents||(t.invParents=new jOWL.Array),t.invParents.pushUnique(i)),r(t)}),i.setParents(s)}var n=new jOWL.Array;return n.flatindex=new jOWL.Array,r(this),n},descendants:function(e){function t(n,i){if(i<=e){i++;var s=n.children();r.concat(s),s.each(function(e){t(e,i)})}}e="number"==typeof e?e:5;var r=this.element.data("descendants");return r&&r.level>=e?r:(r=new jOWL.Array,r.level=e,t(this,1),this.element.data("descendants",r),r)},valueRestrictions:function(e,t){return this.sourceof(null,null,{ignoreClasses:!e})},sourceof:function(e,t,r){r=$.extend({inherited:!0,transitive:!0,ignoreGenerics:!0,ignoreClasses:!1,valuesOnly:!0},r);var n=this.element.data("sourceof");if(!n){n=new jOWL.Array;var i=[].concat(this.restrictions);this.intersections.forEach(function(e){i=i.concat(e.restrictions)}),i.forEach(function(e){var t=!1;n.each(function(r,n){this.property.name==e.property.name&&(t=r)}),t?t.merge(e)||n.push(e):n.push(e)}),this.element.data("sourceof",n)}var s=new jOWL.Array;return n.each(function(){var n=!e,i=!t;if(n||(n=e.isArray?e.contains(this.property):e.URI==this.property.URI),!t&&r.transitive&&this.property.isTransitive){var a=this.getTarget(),o=a.sourceof(this.property,null,r);s.concat(o)}if(i||this.target||(i=!r.valuesOnly),!i){var u=this.getTarget();if(u instanceof jOWL.Type.Class&&r.ignoreClasses)return;i=jOWL.priv.testObjectTarget(t,this.target),!i&&r.transitive&&n&&this.property.isTransitive&&u instanceof jOWL.Type.Individual&&u.sourceof(e,t).length&&(i=!0)}n&&i&&s.pushUnique(this)}),r.inherited?(this.parents().each(function(){this.sourceof&&this.sourceof(e,t,r).each(function(e){var t=this.getTarget(),n=!1,i=new jOWL.Array;s.filter(function(){var s=this,a=!0;return s.property.URI==e.property.URI&&(n=!0,r.ignoreGenerics?t instanceof jOWL.Type.Individual&&(a=s.getTarget()instanceof jOWL.Type.Individual&&e.target!=s.target,i.push(e)):e.target!=s.target&&i.push(e)),a}),n||s.push(e),s.concat(i)})}),s):s}}),jOWL.Type.Intersection=Class.extend({initialize:function(e,t){if(void 0===t)throw new Error("No owner set");if($(e.node).data("binding"))throw"already exists";var r=this;this.element=e,$(this.element.node).data("binding",this),this.owner=t,this._arr=[],this.URI=t.URI,this.matches={},this.classes=[],this.restrictions=[],this.element.children().forEach(function(e){
if(e.hasNodeName(jOWL.NS.owl("Restriction"))){var t=new jOWL.Type.Restriction(e);t.isValueRestriction&&r._arr.push(t),r.restrictions.push(t)}else if(e.hasNodeName(jOWL.NS.owl("Class"))){var n=e.rdfResource();n&&(r.classes.push(n),e.document.subscribe(n).then(function(e){r._arr.push(e)}))}}),e.document._indexIntersection(this)},match:function(e,t,r){if(e==this.URI)return!1;if(void 0!==this.matches[e])return this.matches[e];for(var n=0;n<this._arr.length;n++){var i=this._arr[n],s=!1;if(i instanceof jOWL.Type.Restriction){if($.each(r,function(){if(this.equals(i))return s=!0,!1}),!s)return this.matches[e]=!1,!1}else if(i instanceof jOWL.Type.Class){for(var a=i.element.document.getIDIndex(),o=0;o<t.length;o++){if(i.equals(t[o])){s=!0;break}var u=a[t[o]];if(u)for(var c=i._parentRefs,l=0;l<c.length;l++)if(i.equals(c[l])){s=!0;break}}if(!s)return this.matches[e]=!1,!1}}return this.matches[e]=!0,this.matches[e]},equals:function(e){if(!(e instanceof jOWL.Type.Intersection))return!1;for(var t=0;t<this._arr.length;t++){for(var r=!1,n=0;n<e._arr.length;n++){var i=e._arr[n];i.equals(this._arr[t])&&(r=!0)}if(!r)return!1}return!0}}),jOWL.Type.Restriction=Class.extend({initialize:function(e){if($(e.node).data("binding"))throw new Error("already exists");var t,r,n;this.target=null,this.cachedTarget=null,this.element=e,$(this.element.node).data("binding",this),this.type=this.element.nodeName();var i=this;if(this.propertyURI=null,this.element.hasNodeName(jOWL.NS.owl("Restriction"))?this.element.children().forEach(function(e){e.hasNodeName(jOWL.NS.owl("onProperty"))?(t=e,i.propertyURI=e.rdfResource()):(n=e.nodeName(),r=e)}):(this.propertyURI=jOWL.resolveURI(this.element),this.target=this.element.rdfResource()||this.element.text(),n="Individual"),!this.propertyURI)throw"No Property in restriction";if(this.element.document.subscribe(this.propertyURI).then(function(e){if(i.property=e,e instanceof jOWL.Type.ObjectProperty)if(i.isCardinalityRestriction&&e.range)i.target=e.range;else if(i.isValueRestriction){var t=r.rdfResource();if("anonymousOntologyObject"==t){var n=r.selectSingleNode(jOWL.NS.owl("Class"));n&&(i.cachedTarget=i.element.document.getResource(n))}i.target=t}}),this.restriction={minCard:!1,maxCard:!1,some:[],all:[],value:!1},this.isAnonymous=!0,this.isValueRestriction=n==jOWL.NS.owl("someValuesFrom")||n==jOWL.NS.owl("allValuesFrom")||n==jOWL.NS.owl("hasValue"),this.isCardinalityRestriction=n==jOWL.NS.owl("cardinality")||n==jOWL.NS.owl("maxCardinality")||n==jOWL.NS.owl("minCardinality"),!n)throw"badly formed owl:restriction";switch(n){case jOWL.NS.owl("cardinality"):this.restriction.minCard=this.restriction.maxCard=parseInt(r.text(),10);break;case jOWL.NS.owl("maxCardinality"):this.restriction.maxCard=parseInt(r.text(),10);break;case jOWL.NS.owl("minCardinality"):this.restriction.minCard=parseInt(r.text(),10);break;case jOWL.NS.owl("hasValue"):var s=r.rdfResource();s&&(this.target=s)}var a=this.target||this.restrtype;return this.name=this.propertyURI+"#"+a,this},bind:function(){return null},merge:function(e){if(this.isCardinalityRestriction&&e.isValueRestriction)return this.target=e.target,!0;if(this.isValueRestriction&&e.isCardinalityRestriction)switch(e.restrtype){case jOWL.NS.owl("cardinality"):return this.restriction.minCard=this.restriction.maxCard=e.restriction.minCard,!0;case jOWL.NS.owl("minCardinality"):return this.restriction.minCard=e.restriction.minCard,!0;case jOWL.NS.owl("maxCardinality"):return this.restriction.maxCard=e.restriction.maxCard,!0}return!1},getTarget:function(){return this.target?this.cachedTarget?this.cachedTarget:(this.cachedTarget=this.property instanceof jOWL.Type.ObjectProperty?this.element.document.getResource(this.target):new jOWL.Literal(this.target),this.cachedTarget):jOWL.Thing},equals:function(e){if(!(e instanceof jOWL.Type.Restriction))return!1;if(this.propertyURI==e.propertyURI){if("anonymousOntologyObject"==this.target)return!1;if(this.target&&this.target===e.target)return!0}return!1}}),jOWL.SPARQL_DL_Result=function(){this.assert=void 0,this.head={},this.results=[],this.isBound=!1},jOWL.SPARQL_DL_Result.prototype={sort:function(e){function t(t,r){var n=t[e].name||t[e],i=r[e].name||r[e];return n<i?-1:1}if(!e)throw"parameter must be defined for sort function";this.results&&this.results.sort(t)},jOWLArray:function(e){if(!e)throw"parameter must be defined for jOWLArray function";for(var t=new jOWL.Array,r=0;r<this.results.length;r++)this.results[r][e]&&t.pushUnique(this.results[r][e]);return t},filter:function(e,t){if(void 0===this.head[e])this.head[e]=t;else{var r=this;this.head[e].filter(function(){return t.contains(this)}),t.filter(function(){return r.head[e].contains(this)})}},bind:function(e){if(!this.isBound)return this.results=this.results.concat(e.arr),void(this.isBound=!0);var t=-1,r=null;for(r in e.mappings)t++;var n=[];for(r in e.mappings){var i;t&&(i=e.keyCentric(r));for(var s=this.results.length-1;s>=0;s--){var a=this.results[s][r];if(a){if(!e.mappings[r].contains(a)){this.results.splice(s,1);continue}if(t){for(var o=i[a.URI],u=0;u<o.length;u++){var c=0===u?this.results[s]:{},l=o[u];c[r]=a;for(var h in l)c[h]=l[h];n.push(c)}this.results.splice(s,1)}}}}this.results=this.results.concat(n)}},jOWL.SPARQL_DL_Query=function(e,t,r){if(!(e instanceof jOWL.Document))throw new Error("No Document specified");this.document=e,this.entries=[],this.parse(t),this.fill(r),this.entries=this.entries.sort(this.sort)},jOWL.SPARQL_DL_Query.prototype={parse:function(e){var t=/(\w+)[(]([^)]+)[)]/,r=e.match(/(\w+[(][^)]+[)])/g);if(!r)return void(this.error="invalid abstract sparql-dl syntax");r=jOWL.priv.Array.unique(r);for(var n=0;n<r.length;n++){var i=r[n].match(t);if(3!=i.length)return void(this.error="invalid abstract sparql-dl syntax");r[n]=[i[1],i[2].replace(/ /g,"").split(",")]}this.entries=r},fill:function(e){for(var t=0;t<this.entries.length;t++)for(var r=0;r<this.entries[t][1].length;r++){var n=e[this.entries[t][1][r]];if(void 0!==n)this.entries[t][1][r]=n;else if(n=this.entries[t][1][r],"?"!=n.charAt(0)){if("PropertyValue"==this.entries[t][0]&&2==r){var i=n.match(/^["'](.+)["']$/);if(i&&2==i.length){this.entries[t][1][r]={test:i[1]};break}}if(this.entries[t][1][r]=this.document.getResource(n),null===this.entries[t][1][r])return void(this.entries.error="a parameter in the query was not found")}}},sort:function(e,t){var r;if(1==e[1].length)return"PropertyValue"==t[0]?1:-1;if(1==t[1].length)return"PropertyValue"==e[0]?-1:1;var n=0;for(r=0;r<e[1].length;r++)"string"==typeof e[1][r]&&n++;var i=0;for(r=0;r<e[1].length;r++)"string"==typeof t[1][r]&&i++;return n!=i?n-i:"Type"==e[0]&&"Type"!=t[0]?-1:"Type"!=e[0]&&"Type"==t[0]?1:0}},_Binding.prototype={bind:function(e,t){return this.value[e]=t,this.arr.mappings[e]||(this.arr.mappings[e]=new jOWL.Array),this.arr.mappings[e].push(t),this}},SPARQL_DL_Array.prototype={add:function(e){return this.arr.push(e.value),e},push:function(e,t){var r=new _Binding(this);return r.bind(e,t),this.arr.push(r.value),r},keyCentric:function(e){for(var t={},r=this.arr.length-1;r>=0;r--)this.arr[r][e]&&(t[this.arr[r][e].URI]||(t[this.arr[r][e].URI]=[]),t[this.arr[r][e].URI].push(this.arr[r]));return t},get:function(e){return this.mappings[e]?this.mappings[e]:new jOWL.Array},getArray:function(){for(var e=this.arr.length-1;e>=0;e--){var t=this.arr[e],r=!1;for(var n in t)r||(r=!this.mappings[n]||!this.mappings[n].contains(t[n]));r&&this.arr.splice(e,1)}return this}},jOWL.SPARQL_DL=function(e,t,r,n){if(!(e instanceof jOWL.Document))throw new Error("No Document specified");if(!(this instanceof arguments.callee))return new jOWL.SPARQL_DL(e,t,r,n);this.document=e,this.parameters=$.extend({},r),this.query=new jOWL.SPARQL_DL_Query(e,t,this.parameters).entries,this.result=new jOWL.SPARQL_DL_Result,this.options=$.extend({onComplete:function(e){}},n)},jOWL.SPARQL_DL.prototype={error:function(e){return this.result.error=e,this.options.onComplete(this.result)},execute:function(e){function t(e){if(!(e<r.query.length)){for(var t=0;t<n.results.length;t++){var i=n.results[t];for(var a in i)i[a]instanceof jOWL.Literal&&(i[a]=i[a].name)}return r.options.onComplete(n)}r.process(r.query[e],n,s)}var r=this;if(this.options=$.extend(this.options,e),this.query.error)return this.error(this.query.error);var n=this.result,i=0,s=$.extend({},this.options);return s.onComplete=function(e){i++,n=e,t(i)},this.query.length?void t(i):(n.error="no query found or query did not parse properly",r.options.onComplete(n))},process:function(e,t,r){var n=this.document;if(!n)throw new Error("No Document specified");var i=this;r=$.extend({chewsize:10,async:!0,onComplete:function(e){}},r);var s=e[0],a={Type:[jOWL.NS.owl("Thing"),jOWL.NS.owl("Class")],DirectType:[jOWL.NS.owl("Thing"),jOWL.NS.owl("Class")],PropertyValue:[!1,!1,!1],Class:[!1],Thing:[!1],ObjectProperty:[!1],DatatypeProperty:[!1],SubClassOf:[jOWL.NS.owl("Class"),jOWL.NS.owl("Class")],DirectSubClassOf:[jOWL.NS.owl("Class"),jOWL.NS.owl("Class")]};if(!a[s])return i.error("'"+s+"' queries are not implemented");if(a[s].length!=e[1].length)return i.error("invalid SPARQL-DL "+s+" specifications, "+a[s].length+" parameters required");for(var o=0;o<e[1].length;o++){var u=a[s][o];if(u){var c=e[1][o];if("string"!=typeof c&&c.type!=u)return i.error("Parameter "+o+" in SPARQL-DL Query for "+s+" must be of the type: "+u)}}return"DirectType"==s?(r.childDepth=0,i.fn.Type.call(i,this.document,e[1],t,r)):"DirectSubClassOf"==s?(r.childDepth=1,i.fn.SubClassOf.call(i,this.document,e[1],t,r)):i.fn[s].call(i,this.document,e[1],t,r)},fn:{SubClassOf:function(e,t,r,n){var i=new jOWL.SPARQL_DL.DoubleAtom(t,r.head),s=new SPARQL_DL_Array;if(i.source.isURI()&&i.target.isURI()){if(r.assert!==!1){var a=i.source.value.ancestors();r.assert=a.contains(i.target.value)}return n.onComplete(r)}return i.source.isURI()?(i.source.value.ancestors().each(function(){s.push(i.target.value,this)}),r.filter(i.target.value,s.get(i.target.value)),r.bind(s.getArray()),n.onComplete(r)):i.target.isURI()?(i.target.value.descendants(n.childDepth).each(function(){s.push(i.source.value,this)}),r.filter(i.source.value,s.get(i.source.value)),r.bind(s.getArray()),n.onComplete(r)):this.error("Unsupported SubClassOf query")},Type:function(e,t,r,n){function i(e){if(!f[this.URI]){var t=o.push(a.source.value,this);c&&t.bind(a.target.value,e),f[this.URI]=!0}}function s(e,t){var r=e.parents(),n=!1;return r.contains(t)?n=!0:r.each(function(){this!=jOWL.Thing&&!n&&s(this,t)&&(n=!0)}),n}var a=new jOWL.SPARQL_DL.DoubleAtom(t,r.head);if(a.source.isURI()&&a.target.isURI())return jOWL.SPARQL_DL.priv.assert(r,function(){var e=a.source.value.owlClass();return e.URI==a.target.value.URI||s(e,a.target.value)},n.onComplete);if(a.source.getURIs()&&!a.target.getURIs()){var o=new SPARQL_DL_Array,u=!a.source.isURI(),c=!a.target.isURI();return a.source.getURIs().each(function(){var e;c&&(e=o.push(a.target.value,this.owlClass())),u&&(c?e.bind(a.source.value,this):o.push(a.source.value,this))}),u&&r.filter(a.source.value,o.get(a.source.value)),c&&r.filter(a.target.value,o.get(a.target.value)),r.bind(o.getArray()),n.onComplete(r)}if(a.target.getURIs()){var c=!a.target.isURI(),l=a.target.getURIs(),h={},f={},o=new SPARQL_DL_Array;l.each(function(){if(!h[this.URI]){var e=this.oneOf(),t=this;e.length?e.each(function(){i.call(this,t)}):this.descendants(n.childDepth).each(function(){h[this.URI]=!0}),h[this.URI]=!0}});for(x in h){var p=e.index("Thing")[x];if(p){var d=e.index("ID")[x];n.onUpdate&&n.onUpdate(p),p.each(function(){i.call(this,d)})}}return r.filter(a.source.value,o.get(a.source.value)),r.bind(o.getArray()),n.onComplete(r)}return this.error("Unsupported Type query")},Thing:function(e,t,r,n){jOWL.SPARQL_DL.priv.IDQuery(e,t[0],jOWL.Type.Individual,r,n)},Class:function(e,t,r,n){jOWL.SPARQL_DL.priv.IDQuery(e,t[0],jOWL.Type.Class,r,n)},ObjectProperty:function(e,t,r,n){jOWL.SPARQL_DL.priv.PropertyQuery(e,t[0],e.index("property").items,jOWL.Type.ObjectProperty,r,n)},DatatypeProperty:function(e,t,r,n){jOWL.SPARQL_DL.priv.PropertyQuery(e,t[0],e.index("property").items,jOWL.Type.DatatypeProperty,r,n)},PropertyValue:function(e,t,r,n){var i=new jOWL.SPARQL_DL.TripleAtom(t,r.head);if(i.source.isURI()&&i.property.isURI()&&i.target.isURI())return r.assert!==!1&&jOWL.SPARQL_DL.priv.PropertyValuegetSourceInfo(i.source.value,i.property.value,i.target.value,r,{assert:!0}),n.onComplete(r);if(!i.source.getURIs())return void jOWL.SPARQL_DL.priv.IDQuery(i.source.value,[jOWL.Type.Class,jOWL.Type.Individual],r,n);var s=!!i.target.isVar()&&i.target.value,a=!!i.property.isVar()&&i.property.value,o=!!i.source.isVar()&&i.source.value;return jOWL.SPARQL_DL.priv.PropertyValuegetSourceInfo(i.source.getURIs(),i.property.getURIs(),i.target.getURIs(),r,{filterTarget:s,filterProperty:a,filterSource:o}),n.onComplete(r)}}},jOWL.SPARQL_DL.priv={assert:function(e,t,r){e.assert!==!1&&(e.assert=t()),r(e)},PropertyValuegetSourceInfo:function(e,t,r,n,i){if(!e.isArray)return jOWL.SPARQL_DL.priv.PropertyValuegetSourceInfo(new jOWL.Array([e]),t,r,n,i);i=$.extend({},i);var s=new SPARQL_DL_Array([i.filterSource,i.filterProperty,i.filterTarget]),a=!1;return e.each(function(){var e=this;if(r&&r.isArray&&1==r.length){var n=r.get(0).test;n&&(r=n)}var o=e.sourceof(t,r);if(i.assert)return void(o.length>0&&(a=!0));if(o.length)return o.each(function(){var t=new _Binding(s);return!i.filterSource||(t.bind(i.filterSource,e),i.filterProperty||i.filterTarget)?(i.filterProperty&&t.bind(i.filterProperty,this.property),i.filterTarget&&t.bind(i.filterTarget,this.getTarget()),void s.add(t)):(s.add(t),!1)}),!0}),i.assert?(n.assert=a,n.assert):(i.filterSource&&n.filter(i.filterSource,s.get(i.filterSource)),i.filterProperty&&n.filter(i.filterProperty,s.get(i.filterProperty)),i.filterTarget&&n.filter(i.filterTarget,s.get(i.filterTarget)),void n.bind(s.getArray()))},hasClassID:function(e,t){if("[object Array]"===Object.prototype.toString.call(t)){for(var r=0;r<t.length;r++)if(e instanceof t)return!0}else if(e instanceof t)return!0;return!1},IDQuery:function(e,t,r,n,i){if(!(e instanceof jOWL.Document))throw new Error("No document passed");var s=new jOWL.SPARQL_DL.Atom(t,n.head);if(s.isURI())return jOWL.SPARQL_DL.priv.assert(n,function(){return jOWL.SPARQL_DL.priv.hasClassID(s.getURIs().get(0),r)},i.onComplete);var a=new SPARQL_DL_Array;for(var o in e.index("ID")){var u=e.index("ID")[o];jOWL.SPARQL_DL.priv.hasClassID(u,r)&&a.push(t,u)}n.filter(t,a.get(t)),n.bind(a.getArray()),i.onComplete(n)},PropertyQuery:function(e,t,r,n,i,s){if(!(e instanceof jOWL.Document))throw new Error("No document passed");var a=new jOWL.SPARQL_DL.Atom(t,i.head);if(a.isURI())return jOWL.SPARQL_DL.priv.assert(i,function(){return jOWL.SPARQL_DL.priv.hasClassID(a.getURIs().get(0),n)},s.onComplete);var o=new SPARQL_DL_Array;new jOWL.throttle(r,$.extend({},s,{modify:function(e){return e instanceof jOWL.Type.Thing||(e=jOWL(e)),jOWL.SPARQL_DL.priv.hasClassID(e,n)&&o.push(t,e),!1},onComplete:function(){i.filter(t,o.get(t)),i.bind(o.getArray()),s.onComplete(i)}}))}},jOWL.SPARQL_DL.TripleAtom=function(e,t){this.source=new jOWL.SPARQL_DL.Atom(e[0],t),this.property=new jOWL.SPARQL_DL.Atom(e[1],t),this.target=new jOWL.SPARQL_DL.Atom(e[2],t)},jOWL.SPARQL_DL.DoubleAtom=function(e,t){this.source=new jOWL.SPARQL_DL.Atom(e[0],t),this.target=new jOWL.SPARQL_DL.Atom(e[1],t)},jOWL.SPARQL_DL.Atom=function(e,t){this.value=e,this.type=0,"string"==typeof e?0===e.indexOf("?")?(this.type=this.VAR,t&&t[e]&&(this.mappings=t[e])):this.type=this.LITERAL:this.type=this.URI},jOWL.SPARQL_DL.Atom.prototype={URI:1,LITERAL:2,VAR:3,getURIs:function(){return this.isURI()?new jOWL.Array([this.value]):this.mappings},isVar:function(){return this.type==this.VAR},isLiteral:function(){return this.type==this.LITERAL},isURI:function(){return this.type==this.URI}};