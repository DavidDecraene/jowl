function createSparqlDLWidget(t){function e(t){var e=$("#sparqlresults");if(t.error)e.text("Error: "+t.error);else{if(e.empty(),!t.results||!t.results.length)return e.text("No results found"),void $(".loader").hide();e.append($('<div class="stats"/>').text("Number of results: "+t.results.length));for(var s=0;s<t.results.length;s++){var n=[];for(x in t.results[s]){var i="string"==typeof t.results[s][x]?t.results[s][x]:t.results[s][x].label();n.push(x+" : "+i)}e.append($("<div/>").text(n.join(", ")))}}$(".loader").hide()}$("#sparql").submit(function(){var s=$("input",this).val();$(".loader").show();try{new jOWL.SPARQL_DL(t,s).execute({onComplete:e,expandQuery:!0})}catch(t){console.error(t)}return!1})}function showOverviewResults(t,e,s,n){var i=50,a=$("<div/>").hide();jOWL.throttle(e,{limit:200,modify:function(e){i--;var o=e.bind($("<span class='jowl_link'/>"));o.click(function(){n&&n.propertyChange&&n.propertyChange(t.getResource(this.title))}),i>0?(49!=i&&s.append($("<span/>").text(",   ")),o.appendTo(s)):0===i&&s.append(a),i<=0&&(0!=i&&a.append($("<span/>").text(",   ")),o.appendTo(a))},onComplete:function(t){i<0&&s.append($("<div class='jowl_link' style='margin-top:5px;'/>").text("... ["+i*-1+" more]").click(function(){a.slideDown(),$(this).hide()}))},chewsize:20,timing:5})}function createOverviewWidget(t){function e(e,s,n,i){$("<div/>").hide();new jOWL.SPARQL_DL(t,e).execute({limit:200,onComplete:function(e){e.results&&(showOverviewResults(t,e.jOWLArray("?x"),s,n),i&&i())}})}function s(t){var n=jOWLBrowser.views[t];n&&e(n.query,n.element,n.widget,function(){s(t+1)})}s(0)}function createConceptWidget(t){function e(t){switch(t){case"navbar":$("#navbar").show(),$("#treeview").hide();break;case"treeview":$("#navbar").hide(),$("#treeview").show()}return this}var s={};jOWL.UI.asBroadcaster(s),s.propertyChange=function(t){s.broadcast(t)};var n=$("#conceptwidget"),i=$(".resourcebox",n).owl_propertyLens(t,{term:{split:", "},"sparql-dl:DirectType(?i, owl:Class)":{split:", "},"owl:disjointWith":{split:", "},onChange:{"owl:Thing":function(t,e,s){this.addClass("jowl_tooltip"),a.display(e,this)},"owl:Class":function(t,e,s){s.link(t,e,this)}}}),a=$("#thingwidget .resourcebox").clone(!0).removeClass("owl_UI_box").addClass("owl_UI");a.children(".title").remove(),a=a.owl_propertyLens(t,{tooltip:!0});var o=$("#treeview").owl_treeview(t,{addChildren:!0,isStatic:!0}),r=$("#owlauto").owl_autocomplete(t,{focus:!0,chars:2,filter:"Class"}),l=$("#navbar").owl_navbar(t);return s.show=function(){var e=null;if(configuration.owlClass)e=t.getResource(configuration.owlClass);else for(x in t.getIDIndex()){var s=t.getIDIndex()[x];if(s instanceof jOWL.Type.Class){e=s;break}}e&&this.propertyChange(e)},e($(":radio:checked").val()),$("#owlauto").blur(function(){$(this).siblings(".info").show()}).focus(function(){$(this).siblings(".info").fadeOut(1e3)}).blur(),$(":radio").change(function(){e($(this).val())}),s.addListener([o,l,i]),r.addListener([o,l,i]),o.addListener([l,i]),l.addListener([o,i]),i.addListener([o,l]),s.show(),s}function createPropertyWidget(t){return $("#propertywidget").show(),$("#propertywidget .resourcebox").owl_propertyLens(t,{term:{split:", "}})}function createIndividualsWidget(t){return $("#thingwidget").show(),$("#thingwidget .resourcebox").owl_propertyLens(t,{"sparql-dl:PropertyValue(owl:Thing, ?p, ?t)":{sort:"?p"}})}function createOntologyWidget(t){var e=$("#title").owl_propertyLens(t);e.propertyChange(t.getOntology())}$.fn.extend({owl_autocomplete:function(t,e){if(!(t instanceof jOWL.Document))throw new Error("No Document passed");e=$.extend({time:500,chars:3,focus:!1,limit:10,contentClass:"ui-widget-content",focusClass:jOWL.UI.defaults.focusClass,hintClass:"ui-autocomplete-hint",hint:!1,onSelect:function(t){},formatListItem:function(t,e,s,n){e&&t.append($('<div class="type"/>').text(e)),t.append($('<div class="name"/>').text(s)),n.length&&t.append($('<div class="terms"/>').text(n.join(", ")).prepend($("<span/>").addClass("termlabel").text("Terms: ")))}},e),jOWL.UI.asBroadcaster(this),this.showHint=function(){this.hinted=!0,e.hint?this.addClass(e.hintClass).val(e.hint):this.val("")},this.showHint();var s=this,n="",i=!1;s.val("");var a=$("<ul/>").addClass(e.contentClass).addClass("jowl_autocomplete_results"),o=$("<div/>").addClass(e.wrapperClass).append(a);return this.after(o),a.cache={},a.isEmpty=function(){for(x in a.cache)return!1;return!0},a.close=function(){this.hide()},a.open=function(s,n){if(this.show(),s){if(!n||a.isEmpty())a.cache=t.query(s,e);else{var i={};for(x in a.cache){var o=a.cache[x],r=!1,l=[];x.searchMatch(s)>-1&&(r=!0);for(var c=0;c<o.length;c++)o[c].term.searchMatch(s)>-1&&(r=!0,l.push(o[c]));r&&(i[x]=l)}a.cache=i}this.populate(a.cache)}},a.populate=function(n){var i=this;this.empty();var a=0,o=function(){var n=$(this),i=t.getResource(n.data("jowltype"));e.onSelect.call(n,i)!==!1&&s.broadcast(i)},r=function(){$(this).addClass(e.focusClass)},l=function(){$(this).removeClass(e.focusClass)};for(x in n){if(a<e.limit){var c=n[x],p=jOWL.isExternal(x);p=p?p[1]:x;for(var h=$("<li/>").data("jowltype",x).click(o).hover(r,l).appendTo(i),d=[],u=0;u<c.length;u++){for(var f=!1,v=c[u].term,C=0;C<d.length;C++)d[C].toLowerCase()==v.toLowerCase()&&(f=!0);f||d.push(v)}e.formatListItem.call(h,h,c[0].type,p,d)}a++}},setInterval(function(){var t=s.val(),o=!0;if(n!=t){var r=t.length>n.length&&0===t.indexOf(n);n||(o=!1),n=t,t.length<e.chars&&i?(a.close(),i=!1):t.length>=e.chars&&t.length>0&&(o&&(o=r&&t.length>e.chars),a.open(t,o),i=!0)}},e.time),s.bind("keyup",function(){this.value.length||(a.close(),i=!1)}),s.bind("blur",function(){i&&(setTimeout(function(){a.close()},200),i=!1),s.val().length||s.showHint()}),s.bind("focus",function(){s.hinted&&(s.hinted=!1,$(this).removeClass(e.hintClass).val("")),s.val().length&&!i&&(a.open("",i),i=!0)}),this}});var jOWLBrowser={isReady:!1,views:[]};!function(t){jOWL.UI={broadcaster:function(){var t=[];this.addListener=function(e){function s(e){e.propertyChange&&t.push(e)}if(e.constructor==Array)for(var n=0;n<e.length;n++)s(e[n]);else s(e);return this},this.broadcast=function(e){for(var s=0;s<t.length;s++)t[s].propertyChange.call(t[s],e)},this.propertyChange||(this.propertyChange=function(t){})},asBroadcaster:function(t){t.broadcaster=jOWL.UI.broadcaster,t.broadcaster()},defaults:{contentClass:"jowl-content",focusClass:"ui-state-hover",wrapperClass:"ui-widget-content"}},t.fn.extend({owl_navbar:function(e,s){if(!(e instanceof jOWL.Document))throw new Error("No Document passed");s=t.extend({contentClass:jOWL.UI.defaults.contentClass,focusClass:jOWL.UI.defaults.focusClass,onSelect:function(t){},onPropertyChange:function(t){}},s);var n=this;this.addClass("jowl-navbar"),this.content=t("."+s.contentClass,this).empty(),this.content.length||(this.content=t("<div/>").addClass(s.contentClass).appendTo(this)),this.parents=t("<div/>").appendTo(this.content),this.focus=t("<div/>").addClass(s.focusClass).appendTo(this.content),this.children=t("<div/>").appendTo(this.content);var i=t("<span/>").click(function(){var i=t(this),a=e.getResource(i.attr("title"));s.onSelect.call(i,a)!==!1&&a&&a instanceof jOWL.Type.Class&&(n.propertyChange.call(a,a),n.broadcast(a))});return jOWL.UI.asBroadcaster(this),this.propertyChange=function(t){s.onPropertyChange.call(this,t)!==!1&&t instanceof jOWL.Type.Class&&(t.bind(n.focus),jOWL.options.reason&&t.hierarchy(),n.parents.empty().append(t.parents().bind(i)),n.children.empty().append(t.children().bind(i)))},this},owl_datafield:function(e,s){if(!(e instanceof jOWL.Document))throw new Error("No document specified");s=t.extend({selectorClass:"jowl-datafield-selector",messageClass:"jowl-datafield-message",labelClass:"jowl-datafield-property-label"},s);var n=this,i={};return this.messages={},this.messages[jOWL.NS.xsd()+"positiveInteger"]="Allowed values: positive numbers or comparisons like  '>5 && <15' ",this.addClass("owl_UI"),jOWL.UI.asBroadcaster(this),this.property=null,this.propertyChange=function(t){if(t.isClass){this.property=t;for(x in i)i[x].remove&&(i[x].remove(),delete i[x])}},this.addField=function(a){if(!i[a.URI]){var o=t("<div/>");i[a.URI]=o;a.bind(t("<div/>")).addClass(s.labelClass).appendTo(o).click(function(){o.remove(),delete i[a.URI]});if(a.isObjectProperty){new jOWL.SPARQL_DL(e,"Type(?t, ?c),PropertyValue(concept, property, ?c)",{concept:n.property,property:a}).execute({onComplete:function(e){if(e.results.length){e.sort("?t"),$select=t("<select class='"+s.selectorClass+"'/>").appendTo(o);for(var i=0;i<e.results.length;i++)e.results[i]["?t"].bind(t("<option/>")).appendTo($select);o.appendTo(n)}}})}else if(a.isDatatypeProperty){var r="";n.messages[a.range]&&(r=n.messages[a.range]);var l=t("<div/>").addClass(s.selectorClass).attr("title",a.range).append(t('<input type="text" style="font-size:11px;width:100px;"/>')),c=t("<div/>").addClass(s.messageClass).text(r).appendTo(l);o.append(l).appendTo(n),t("input",o).focus(function(){c.animate({opacity:1},1500).fadeOut()})}}},this.serialize=function(){var e={Type:n.property,PropertyValue:[]};return t("."+s.selectorClass,n).each(function(){var n=t(this),i=n.siblings("."+s.labelClass),a=i.attr("title");if(n.is("select")){var o=n.get(0),r=t(o[o.selectedIndex]).attr("title");e.PropertyValue.push([a,r])}else{var l=n.find("input"),c=(n.attr("title"),l.get(0).value);c&&e.PropertyValue.push([a,'"'+c+'"'])}}),e},this}}),t.fn.swapClass=function(e,s){return this.each(function(){t(this).hasClass(e)?(t(this).removeClass(e),t(this).addClass(s)):t(this).hasClass(s)&&(t(this).removeClass(s),t(this).addClass(e))})}}(jQuery),jOWL.UI.Template=function(t,e,s){function n(t,e){var s=!1;return!!t&&("string"==typeof t?(e.html(t),s=!0):t.constructor==Array?2==t.length&&(t[1].bind(e).text(t[0]),s=!0):t.bind&&(t.bind(e),s=!0),s)}var i={resultClass:"jowl-template-result",splitterClass:"jowl-template-splitter"};if(t){for(var a=0,o=[],r={},l=function(){var t=$(this).text();0===t.indexOf("${")&&t.lastIndexOf("}")==t.length-1&&$(this).hide()},c=0;c<t.length;c++){var p=e.clone(!0).wrapInner("<"+e.get(0).nodeName+" class='"+i.resultClass+"'/>").children();p.addClass(e.attr("class")).removeClass("propertybox");for(obj in t[c]){r[obj]||(r[obj]=[]);var h=$(":contains(${"+obj+"})",p);h.length?h.each(function(){if(this.innerHTML=="${"+obj+"}"){var e=$(this);n(t[c][obj],e)&&(a++,r[obj].push(this))}}):p.text()=="${"+obj+"}"&&n(t[c][obj],p)&&(a++,r[obj].push(p.get(0)))}var d=$(":contains(${)",p);d.each(l),a&&(p.insertBefore(e),o.push(p.get(0)),a>1&&s&&($splitter=0===s.indexOf("<")?$(s):$("<span/>").text(s),$splitter.addClass(i.splitterClass).insertBefore(p)))}for(p in r)r[p].length&&(r[p]=$(r[p]));var u=$(o);return $.data(u,"parameters",r),u}},jOWL.UI.PropertyBox=Class.extend({initialize:function(t,e,s){var n=$("[data-jowl]",e);n.length&&(this.descendant=!0),this.document=t,this.el=e,this.resourcebox=s,this.valuebox=n.length?n:e,this.actiontype=this.valuebox.attr("data-jowl")},setResults:function(t,e){var s=jOWL.UI.Template(t,this.valuebox,this.resourcebox.options[this.actiontype].split);this.complete(s,e),s&&s.length&&this.descendant&&(this.el.show(),this.valuebox.hide()),this.resourcebox.options[this.actiontype].onComplete&&this.resourcebox.options[this.actiontype].onComplete.call(this.el.get(0))},complete:function(t,e){var s=this.resourcebox,n=this;if(t&&t.length){var i=$.data(t,"parameters");for(x in i)i[x].length&&"function"==typeof s.options[this.actiontype][x]&&i[x].each(s.options[this.actiontype][x]);for(x in s.options.onChange){var a=$('[typeof="'+x+'"]',t).add(t.filter('[typeof="'+x+'"]'));"."!=x.charAt(0)&&"#"!=x.charAt(0)||(a=a.add($(x,t))),a.each(function(){var t=$(this);$.data(t,"data-jowl",x);var i=t.attr("title");"anonymousOntologyObject"!=i&&s.options.onChange[$.data(t,"data-jowl")].call(t,e,n.document.getResource(i),s)})}}},clear:function(){var t=this.valuebox.prev(".jowl-template-result");t.length||(t=this.valuebox.prev(".jowl-template-splitter")),t.length&&(t.remove(),this.clear(this.valuebox))}}),$.fn.extend({owl_propertyLens:function(t,e){var s=this;s.options=$.extend({backlinkClass:"backlink",split:{},disable:{},click:{}},e),s.resourcetype=this.attr("data-jowl")||"owl:Class";var n=[];$(".propertybox",this).each(function(){var e=new jOWL.UI.PropertyBox(t,$(this),s);n.push(e),e.el.hide()});var i=$(".backlink",this).hide();i.length||(i=$('<div class="jowl_link"/>').addClass(s.options.backlinkClass).text("Back").hide().appendTo(this)),jOWL.UI.asBroadcaster(this),this.link=function(t,e,n,a){n.addClass("jowl_link").click(function(){a&&a(),s.broadcast(e),s.propertyChange(e),i.source=t.name,i.show().unbind("click").click(function(){s.broadcast(t),s.propertyChange(t),i.hide()})})};var a={"rdfs:label":function(t){return[{"rdfs:label":t.label()}]},"rdf:ID":function(t){return[{"rdf:ID":[t.name,t]}]},"rdfs:comment":function(t){return $.map(t.description(),function(t){return{"rdfs:comment":t}})},"rdf:type":function(t){return t.owlClass?[{"rdf:type":t.owlClass()}]:[{"rdf:type":t.type}]},term:function(t){return $.map(t.terms(),function(t,e){return{term:t[0]}})},"rdfs:range":function(t){if(t.range)return[{"rdfs:range":t.range}]},"rdfs:domain":function(t){if(t.domain)return[{"rdfs:domain":t.domain}]},permalink:function(t){var e=jOWL.permalink(t);return[{permalink:"<a href='"+e+"'>Permalink</a>"}]},"owl:disjointWith":function(t){if(t instanceof jOWL.Type.Class)return $.map(jOWL.Xpath("*",t.jnode).filter(function(){return"owl:disjointWith"==this.nodeName}),function(t,e){return{"owl:disjointWith":jOWL($(t).RDF_Resource())}})},default:function(t){var e=this.attr("data-jowl");return $.map(jOWL.Xpath("*",t.jnode).filter(function(){return this.nodeName==e}),function(t,s){var n={};return n[e]=$(t).text(),n})}};if(this.propertyChange=function(e){if(e){if(s.property=e,i.source!=e.name?i.hide():i.source=!1,e.type!=s.resourcetype)if(e.isDatatypeProperty&&"rdf:Property"==s.resourcetype);else if(!e.isObjectProperty||"rdf:Property"!=s.resourcetype)return;for(var o=0;o<n.length;o++){var r=n[o];if(r.clear(),!r.actiontype)return;var l=r.actiontype;if(s.options.disable[l])return;if(s.options[l]||(s.options[l]={}),0===l.indexOf("sparql-dl:")){var c=l.split("sparql-dl:",2)[1],p={};p[s.resourcetype]=e,s.options[l].prefill&&$.extend(p,s.options[l].prefill);new jOWL.SPARQL_DL(t,c,p).execute({onComplete:function(t){s.options[l].sort&&t.sort(s.options[l].sort),r.setResults(t.results,e)}})}else{var h=a[l]?l:"default",d=a[h].call(r.valuebox,e);r.setResults(d,e)}}s.options.onUpdate&&s.options.onUpdate.call(this,e)}},s.options.tooltip){var o=this.remove();this.display=function(t,e){e.tooltip({title:t.label(),html:function(){return o.propertyChange(t),i.hide(),o.get(0)}})}}return this}}),jOWL.UI.TreeModel=Class.extend({initialize:function(t,e){e.setModel(this),this.document=t.element.document,this.options=e.options;var s=t.hierarchy(!0);if(this.options.rootThing)this.traverse(s,e.root(jOWL.Thing));else for(var n=e.root(s),i=0;i<n.length;i++)this.traverse(n[i].invParents,n[i]),n[i].invParents||this.leaf(n[i]);this.clear(t)},clear:function(t){var e=this;t.parents&&t.parents().each(function(){this.invParents=null,e.clear(this)})},leaf:function(t){if(t.jnode.addClass(this.options.focusClass),this.options.addChildren){var e=this.document.getResource(t.$name.attr("title"));e&&e.children&&e.children().each(function(){t.add(this)})}},traverse:function(t,e){if(t){var s=this;t.each(function(){var t=e.add(this);this.invParents?s.traverse(this.invParents,t):s.leaf(t)})}}}),jOWL.UI.TreeNode=Class.extend({initialize:function(t,e,s){this.tree=t;var n=this;if(this.jnode=s?$("<li/>").addClass(this.tree.options.rootClass):$('<li class="tvi"/>'),this.$name=null,e){this.$name=$("<span/>").addClass(this.tree.options.nameClass),"string"==typeof e?this.$name.html(e):e.bind&&e.bind(this.$name);var i=this.$name;this.$name.appendTo(this.jnode).click(function(){var e=t.model.document.getResource(i.attr("title"));if(!e||t.options.onSelect.call(i,e)!==!1)return t.broadcast(e),t.options.isStatic&&t.propertyChange(e),!1})}this.wrapper=$("<ul/>").appendTo(this.jnode),this.jnode.click(function(){return n.toggle(),!1})},add:function(t){var e=new jOWL.UI.TreeNode(this.tree,t,!1);if(this.wrapper.children().length){var s=this.wrapper.children(":last");s.swapClass("tvilc","tvic"),s.swapClass("tvile","tvie"),s.swapClass("tvil","tvi")}else this.toNode();return this.wrapper.append(e.jnode.swapClass("tvi","tvil")),e},toggle:function(){var t=this.jnode.hasClass("tvic")||this.jnode.hasClass("tvie")||this.jnode.hasClass("tvilc")||this.jnode.hasClass("tvile");t&&(this.jnode.swapClass("tvic","tvie"),this.jnode.swapClass("tvilc","tvile"),this.wrapper.slideToggle())},toNode:function(){this.jnode.swapClass("tvil","tvilc"),this.jnode.swapClass("tvi","tvic")}}),jOWL.UI.Tree=Class.extend({initialize:function(t,e){this.options=e,this.rack=$("<ul/>").addClass(e.treeClass).appendTo(t)},root:function(t){var e=null,s=this;return this.rack.empty(),t&&t.each?(e=[],t.each(function(t){var n=new jOWL.UI.TreeNode(s,t,!0);n.wrapper.addClass("tv"),n.jnode.appendTo(s.rack),n.invParents=t.invParents,t.invParents=null,e.push(n)}),e):(e=new fn.node(t,!0),e.wrapper.addClass("tv"),e.jnode.appendTo(this.rack),e)},propertyChange:function(t){if(t instanceof jOWL.Type.Class){new jOWL.UI.TreeModel(t,this)}},setModel:function(t){this.model=t}}),$.fn.extend({owl_treeview:function(t,e){if(!(t instanceof jOWL.Document))throw new Error("No Document passed");e=$.extend({contentClass:jOWL.UI.defaults.contentClass,focusClass:"focus",nameClass:"name",treeClass:"jowl-treeview",rootClass:"root",onSelect:function(t){},rootThing:!1,isStatic:!1,addChildren:!1},e),this.addClass("jowl-tree"),this.content=$("."+e.contentClass,this).empty(),this.content.length||(this.content=$("<div/>").addClass(e.contentClass).appendTo(this));var s=new jOWL.UI.Tree(this.content,e);return jOWL.UI.asBroadcaster(s),s}});